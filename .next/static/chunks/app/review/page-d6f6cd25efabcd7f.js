(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{6820:function(e,t,a){Promise.resolve().then(a.bind(a,7811))},6865:function(e,t,a){"use strict";a.d(t,{DocumentProvider:function(){return r},s:function(){return o}});var s=a(7437),l=a(2265);let n=(0,l.createContext)(void 0),r=e=>{let{children:t}=e,[a,r]=(0,l.useState)(null),[o,i]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),[u,p]=(0,l.useState)([]);return(0,s.jsx)(n.Provider,{value:{generateDocument:a,setGenerateDocument:r,reviewDocument:o,setReviewDocument:i,compareDocument:c,setCompareDocument:d,documents:u,addDocument:e=>{p(t=>[...t.filter(t=>t.id!==e.id),e])}},children:t})},o=()=>{let e=(0,l.useContext)(n);if(!e)throw Error("useDocuments must be used within a DocumentProvider");return e}},7811:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(7437),l=a(2265),n=a(1671);let r=(0,a(9205).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var o=a(4502),i=a(8736),c=a(2489),d=a(7689),u=a(6865),p=()=>{var e;let{reviewDocument:t,setReviewDocument:a,addDocument:p}=(0,u.s)(),[m,h]=(0,l.useState)(null),[x,g]=(0,l.useState)(""),[f,y]=(0,l.useState)(!1),[v,b]=(0,l.useState)([]),[w,j]=(0,l.useState)(null),[N,k]=(0,l.useState)(null),[S,_]=(0,l.useState)(null),[A,C]=(0,l.useState)(!1),[Z,D]=(0,l.useState)([{value:"msa",label:"Master Service Agreement (MSA)"},{value:"nda",label:"Non-Disclosure Agreement (NDA)"},{value:"sla",label:"Service Level Agreement (SLA)"},{value:"employment",label:"Employment Contract"},{value:"vendor",label:"Vendor Agreement"}]),E=(0,l.useRef)(null);(0,l.useEffect)(()=>{M(),P()},[]),(0,l.useEffect)(()=>{if(t&&!m){console.log("Setting contract type from reviewDocument:",t.type),g(t.type),h(t.file||null);let e=t.metadata;(null==e?void 0:e.session_id)&&(j(e.session_id),_({message:"File uploaded successfully",session_id:e.session_id,filename:t.name}))}},[t,m]);let M=async()=>{try{let e=await fetch("/api/templates",{method:"GET",headers:{Accept:"application/json"}});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to fetch templates")}let t=await e.json();console.log("Templates response:",t);let a=[];if(Array.isArray(t))a=t;else if(t.templates&&Array.isArray(t.templates))a=t.templates;else if(t.data&&Array.isArray(t.data))a=t.data;else{console.warn("Unexpected templates response structure, using fallback contract types");return}let s=a.map(e=>({value:(e.name||e.id||e.type||"").toLowerCase(),label:e.description||e.name||e.type||"Unknown Template"}));console.log("Mapped templates:",s),D(s.length>0?s:Z)}catch(e){console.error("Template fetch error:",e),k(e.message||"Failed to load contract types, using fallback options")}},P=async()=>{try{let e=await fetch("/api/session/create",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=e.headers.get("Content-Type"),a="Failed to create session";throw a=(null==t?void 0:t.includes("application/json"))?(await e.json()).error||a:"".concat(a," (Status: ").concat(e.status," ").concat(e.statusText,")"),Error(a)}let t=await e.json();if(!t.session_id)throw Error("Session ID not returned");console.log("Session created:",t.session_id),j(t.session_id)}catch(e){console.error("Session creation error:",e),k(e.message||"An unexpected error occurred during session creation")}},T=async e=>{var s;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(l){if(console.log("File uploaded:",{name:l.name,type:l.type,size:l.size}),h(l),_(null),k(null),C(!0),t&&t.type!==x&&(console.log("Clearing reviewDocument, preserving contractType:",x),a(null)),w||(console.log("No session ID, creating new session"),await P()),!x){k("Please select a contract type before uploading the document."),C(!1);return}if(!w){k("Session could not be created. Please try again."),C(!1);return}try{let e;let t=new FormData;t.append("file",l),t.append("template_type",x),t.append("session_id",w),console.log("Sending upload request with:",{template_type:x,session_id:w,file_name:l.name});let s=await fetch("/api/contracts/upload-for-review",{method:"POST",body:t}),n=s.headers.get("Content-Type");if(e=(null==n?void 0:n.includes("application/json"))?await s.json():{text:await s.text()},console.log("Upload response:",{status:s.status,ok:s.ok,data:e}),!s.ok){let t=e.error||e.details||"Failed to upload document";throw(null==n?void 0:n.includes("application/json"))||(t="Failed to upload document (Status: ".concat(s.status," ").concat(s.statusText,")")),Error(t)}if(!e.message)throw Error("Unexpected response format: No message field");_(e),console.log("Upload successful, response set:",e);let r={id:"upload_".concat(Date.now()),name:l.name.replace(/\.[^/.]+$/,""),type:x,content:null,metadata:{template_type:x,enterprise_name:"",client_name:"",effective_date:"",valid_duration:"",notice_period:"",generatedAt:new Date().toISOString(),session_id:w,uploadedAt:new Date().toISOString()},file:l};a(r),p(r)}catch(e){console.error("Upload error:",e.message),k(e.message||"Failed to upload document. Please try again."),h(null),_(null)}finally{C(!1)}}},F=async()=>{if(!m||!x||!w){k("Please upload a document, select a contract type, and ensure a session is active.");return}if(console.log("Analyzing contract, uploadResponse:",S),!S){k("Document upload not completed. Please upload the document again.");return}if(!["File uploaded successfully","Upload successful","Document uploaded"].includes(S.message)){k("Upload issue: ".concat(S.message||"Unknown error",". Please upload the document again."));return}y(!0),k(null);let e=0,s=null;for(;e<3;)try{let e=new URLSearchParams;e.append("session_id",w);let t=await fetch("/api/contracts/evaluate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:e});if(!t.ok){let e=t.headers.get("Content-Type"),a="Failed to evaluate contract";if(null==e?void 0:e.includes("application/json")){let e=await t.json();a=e.error||e.details||a}else a="".concat(a," (Status: ").concat(t.status," ").concat(t.statusText,")");throw Error(a)}s=await t.json(),console.log("Evaluation response:",s);break}catch(t){if(3==++e){console.error("Max retries reached. Evaluation failed:",t),k("Failed to evaluate the contract after multiple attempts. Please try again or contact support."),y(!1);return}await new Promise(t=>setTimeout(t,1e3*e))}try{if(s){let{questions:e,answers:l}=s,n=e.map((e,t)=>{let a=l[t]||"No answer provided.",s="good";return a.includes("NA - Not Applicable")||a.startsWith("No")?s="good":a.includes("partially")||a.includes("could be")?s="warning":(a.includes("issue")||a.includes("excessive"))&&(s="critical"),{id:String(t),question:e,answer:a,status:s}});b(n);let r={id:(null==t?void 0:t.id)||"analyzed_".concat(Date.now()),name:m.name.replace(/\.[^/.]+$/,""),type:x,content:(null==t?void 0:t.content)||null,metadata:{template_type:x,enterprise_name:(null==t?void 0:t.metadata.enterprise_name)||"",client_name:(null==t?void 0:t.metadata.client_name)||"",effective_date:(null==t?void 0:t.metadata.effective_date)||"",valid_duration:(null==t?void 0:t.metadata.valid_duration)||"",notice_period:(null==t?void 0:t.metadata.notice_period)||"",generatedAt:(null==t?void 0:t.metadata.generatedAt)||new Date().toISOString(),session_id:w,analyzedAt:new Date().toISOString()},file:m,evaluation:n};p(r),a(r)}}catch(e){console.error("Evaluation processing error:",e),k(e.message||"Failed to process the evaluation results. Please try again or contact support.")}finally{y(!1)}},z=e=>{switch(e){case"good":return(0,s.jsx)(n.Z,{className:"w-5 h-5 text-green-500"});case"warning":return(0,s.jsx)(r,{className:"w-5 h-5 text-yellow-500"});case"critical":return(0,s.jsx)(r,{className:"w-5 h-5 text-red-500"});default:return null}};return(0,s.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-8",children:[(0,s.jsx)("div",{className:"bg-teal-500 w-12 h-12 rounded-lg flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Evaluate Contract"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Analyze contracts with AI-powered evaluation"})]})]}),t&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5 text-blue-600"}),(0,s.jsx)("span",{className:"font-medium text-blue-800",children:"Document from Generation"})]}),(0,s.jsxs)("p",{className:"text-sm text-blue-700 mt-1",children:["Ready to analyze: ",t.name," (",(null===(e=Z.find(e=>e.value===t.type))||void 0===e?void 0:e.label)||t.type,")"]})]}),N&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 text-red-600"}),(0,s.jsx)("span",{className:"text-sm text-red-700",children:N})]})}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Contract Type ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{value:x,onChange:e=>{console.log("Contract type selected:",e.target.value),g(e.target.value)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-emphasis",required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select contract type"}),Z.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-teal-400 transition-colors",children:[(0,s.jsx)(d.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Upload Contract Document"}),(0,s.jsx)("p",{className:"text-gray-600 mb-3",children:"Support for Word (.doc, .docx), PDF, and text (.txt) files"}),(0,s.jsx)("input",{type:"file",accept:".doc,.docx,.pdf,.txt",onChange:T,className:"hidden",id:"file-upload",ref:E}),(0,s.jsx)("button",{type:"button",onClick:()=>{E.current&&E.current.click()},disabled:A,className:"px-6 py-2 text-white bg-teal-600 rounded-lg font-semibold hover:bg-teal-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:A?"Uploading...":"Choose File"}),m&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-teal-50 border border-gray-200 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"w-4 h-4 text-teal-600"}),(0,s.jsx)("span",{className:"text-sm text-teal-800 truncate",children:m.name})]})})]}),(0,s.jsx)("button",{onClick:F,disabled:f||A||!m||!x||!w||!(null==S?void 0:S.message),className:"w-full mt-4 py-3 px-6 text-white bg-teal-700 rounded-lg font-semibold hover:bg-teal-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Analyzing Contract..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Analyze Contract"})]})})]}),(0,s.jsxs)("div",{children:[v.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contract Evaluation Results"}),(0,s.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:v.map(e=>(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[z(e.status),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:e.question}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.answer})]})]})},e.id))})]}),0===v.length&&!f&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(o.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ready to Analyze"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Upload a contract document and select its type to get started"})]})]})]})]})})})}},9205:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var s=a(2265);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),r=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()},i=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,s.forwardRef)((e,t)=>{let{color:a="currentColor",size:l=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:d="",children:u,iconNode:p,...m}=e;return(0,s.createElement)("svg",{ref:t,...c,width:l,height:l,stroke:a,strokeWidth:r?24*Number(n)/Number(l):n,className:o("lucide",d),...!u&&!i(m)&&{"aria-hidden":"true"},...m},[...p.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{className:i,...c}=a;return(0,s.createElement)(d,{ref:n,iconNode:t,className:o("lucide-".concat(l(r(e))),"lucide-".concat(e),i),...c})});return a.displayName=r(e),a}},1671:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8736:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},4502:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]])},7689:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2489:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},function(e){e.O(0,[971,117,744],function(){return e(e.s=6820)}),_N_E=e.O()}]);